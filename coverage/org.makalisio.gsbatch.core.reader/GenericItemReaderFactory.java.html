<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="fr"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>GenericItemReaderFactory.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">gsbatch</a> &gt; <a href="index.source.html" class="el_package">org.makalisio.gsbatch.core.reader</a> &gt; <span class="el_source">GenericItemReaderFactory.java</span></div><h1>GenericItemReaderFactory.java</h1><pre class="source lang-java linenums">// org.makalisio.gsbatch.core.reader.GenericItemReaderFactory
package org.makalisio.gsbatch.core.reader;

import lombok.extern.slf4j.Slf4j;
import org.makalisio.gsbatch.core.model.GenericRecord;
import org.makalisio.gsbatch.core.model.SourceConfig;
import org.springframework.batch.item.ItemStreamReader;
import java.util.Map;
import org.springframework.stereotype.Component;

/**
 * Factory for creating ItemReaders based on source type.
 * Supports multiple source types (CSV, SQL, etc.) with extensible architecture.
 *
 * @author Makalisio
 * @since 0.0.1
 */
<span class="fc" id="L18">@Slf4j</span>
@Component
public class GenericItemReaderFactory {

    private final CsvGenericItemReaderBuilder csvReaderBuilder;
    private final SqlGenericItemReaderBuilder sqlReaderBuilder;
    private final RestGenericItemReaderBuilder restReaderBuilder;
    private final SoapGenericItemReaderBuilder soapReaderBuilder;

    /**
     * @param csvReaderBuilder  builder for CSV sources
     * @param sqlReaderBuilder  builder for SQL sources
     * @param restReaderBuilder builder for REST API sources
     * @param soapReaderBuilder builder for SOAP WebService sources
     */
    public GenericItemReaderFactory(CsvGenericItemReaderBuilder csvReaderBuilder,
                                    SqlGenericItemReaderBuilder sqlReaderBuilder,
                                    RestGenericItemReaderBuilder restReaderBuilder,
<span class="fc" id="L36">                                    SoapGenericItemReaderBuilder soapReaderBuilder) {</span>
<span class="fc" id="L37">        this.csvReaderBuilder = csvReaderBuilder;</span>
<span class="fc" id="L38">        this.sqlReaderBuilder = sqlReaderBuilder;</span>
<span class="fc" id="L39">        this.restReaderBuilder = restReaderBuilder;</span>
<span class="fc" id="L40">        this.soapReaderBuilder = soapReaderBuilder;</span>
<span class="fc" id="L41">        log.info(&quot;GenericItemReaderFactory initialized&quot;);</span>
<span class="fc" id="L42">    }</span>

    /**
     * Builds an ItemReader based on the source configuration.
     *
     * @param config        the source configuration
     * @param jobParameters all job parameters (used for bind variables in SQL and REST)
     * @return configured ItemStreamReader (extends ItemReader + ItemStream)
     * @throws IllegalArgumentException if source type is unsupported or null
     */
    public ItemStreamReader&lt;GenericRecord&gt; buildReader(SourceConfig config, Map&lt;String, Object&gt; jobParameters) {
<span class="fc bfc" id="L53" title="All 2 branches covered.">        if (config == null) {</span>
<span class="fc" id="L54">            throw new IllegalArgumentException(&quot;SourceConfig cannot be null&quot;);</span>
        }

<span class="fc" id="L57">        String type = config.getType();</span>
<span class="fc bfc" id="L58" title="All 4 branches covered.">        if (type == null || type.isBlank()) {</span>
<span class="fc" id="L59">            throw new IllegalArgumentException(</span>
<span class="fc" id="L60">                &quot;Source type must not be null or blank for source: &quot; + config.getName()</span>
            );
        }

<span class="fc" id="L64">        log.debug(&quot;Building reader for source '{}' of type: {}&quot;, config.getName(), type);</span>

<span class="fc bfc" id="L66" title="All 7 branches covered.">        switch (type.toUpperCase()) {</span>
            case &quot;CSV&quot;:
<span class="fc" id="L68">                return csvReaderBuilder.build(config);  // CSV does not use jobParameters</span>
            
            case &quot;SQL&quot;:
<span class="fc" id="L71">                return sqlReaderBuilder.build(config, jobParameters);</span>
            
            case &quot;REST&quot;:
<span class="fc" id="L74">                return restReaderBuilder.build(config, jobParameters);</span>
            
            case &quot;SOAP&quot;:
<span class="fc" id="L77">                return soapReaderBuilder.build(config, jobParameters);</span>
            
            case &quot;JSON&quot;:
<span class="fc" id="L80">                throw new UnsupportedOperationException(</span>
<span class="fc" id="L81">                    &quot;JSON reader not yet implemented for source: &quot; + config.getName()</span>
                );
            
            case &quot;XML&quot;:
<span class="fc" id="L85">                throw new UnsupportedOperationException(</span>
<span class="fc" id="L86">                    &quot;XML reader not yet implemented for source: &quot; + config.getName()</span>
                );
            
            default:
<span class="fc" id="L90">                String errorMsg = String.format(</span>
                    &quot;Unsupported source type '%s' for source: %s. Supported types: CSV, SQL, REST, SOAP&quot;,
<span class="fc" id="L92">                    type, config.getName()</span>
                );
<span class="fc" id="L94">                log.error(errorMsg);</span>
<span class="fc" id="L95">                throw new IllegalArgumentException(errorMsg);</span>
        }
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>